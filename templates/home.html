{% extends 'base.html' %}
{% load static %}

{% block meta_description %}Discover fresh, organic farm products from local farmers. Quality vegetables, fruits, livestock, and agricultural supplies delivered fresh to your doorstep in Kenya.{% endblock %}

{% block content %}
<!-- Carousel Start -->
<div class="container-fluid p-0 mb-5 wow fadeIn" data-wow-delay="0.1s">
    <div id="header-carousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img class="w-100" src="{% static 'img/carousel-1.jpg'%}" alt="Fresh Farm Products">
                <div class="carousel-caption">
                    <div class="container">
                        <div class="row justify-content-start">
                            <div class="col-lg-7">
                                <h1 class="display-2 mb-5 animated slideInDown">Direct from Farm to Your Table</h1>
                                <p class="fs-4 text-white mb-4 animated slideInDown">Connect with local farmers and get the freshest produce delivered to your doorstep</p>
                                <a href="{% url 'product_list' %}" class="btn btn-primary rounded-pill py-sm-3 px-sm-5">Browse Products</a>
                                <a href="#categories" class="btn btn-secondary rounded-pill py-sm-3 px-sm-5 ms-3">Explore Categories</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="carousel-item">
                <img class="w-100" src="{% static 'img/carousel-2.jpg'%}" alt="Organic Farming">
                <div class="carousel-caption">
                    <div class="container">
                        <div class="row justify-content-start">
                            <div class="col-lg-7">
                                <h1 class="display-2 mb-5 animated slideInDown">Organic & Sustainable Farming</h1>
                                <p class="fs-4 text-white mb-4 animated slideInDown">Supporting eco-friendly farming practices across Kenya</p>
                                <a href="{% url 'product_list' %}?is_organic=true" class="btn btn-primary rounded-pill py-sm-3 px-sm-5">Organic Products</a>
                                <a href="#features" class="btn btn-secondary rounded-pill py-sm-3 px-sm-5 ms-3">Learn More</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#header-carousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#header-carousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
</div>
<!-- Carousel End -->

<!-- Featured Products Start -->
<section class="container-xxl py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-6 mb-2">Featured Products</h2>
            <p class="text-muted">Handpicked quality products from trusted farmers</p>
        </div>
        <div class="row g-4">
            {% for product in featured_products %}
            <div class="col-xl-3 col-lg-4 col-md-6">
                <div class="product-item card h-100 border-0 shadow-sm">
                    <div class="position-relative product-image-container" style="height: 220px; overflow: hidden;">
                        {% if product.main_image %}
                        <img src="{{ product.main_image.image.url }}" class="card-img-top w-100 h-100" alt="{{ product.name }}" style="object-fit: cover;">
                        {% else %}
                        <div class="bg-light d-flex align-items-center justify-content-center h-100">
                            <i class="fas fa-seedling text-muted fs-1"></i>
                        </div>
                        {% endif %}
                        
                        <!-- Product badges -->
                        {% if product.is_featured %}
                        <span class="badge bg-warning position-absolute top-0 start-0 m-2 px-2 py-1" style="font-size: 0.7rem;">Featured</span>
                        {% endif %}
                        
                        {% if product.discount_percentage %}
                        <span class="badge bg-danger position-absolute top-0 end-0 m-2 px-2 py-1" style="font-size: 0.7rem;">
                            -{{ product.discount_percentage }}%
                        </span>
                        {% elif product.is_organic %}
                        <span class="badge bg-success position-absolute top-0 end-0 m-2 px-2 py-1" style="font-size: 0.7rem;">Organic</span>
                        {% endif %}

                        <!-- Stock status badge -->
                        {% if product.stock_status == 'low_stock' %}
                        <span class="badge bg-warning position-absolute bottom-0 end-0 m-2 px-2 py-1" style="font-size: 0.6rem;">Low Stock</span>
                        {% elif product.stock_status == 'sold_out' %}
                        <span class="badge bg-secondary position-absolute bottom-0 end-0 m-2 px-2 py-1" style="font-size: 0.6rem;">Sold Out</span>
                        {% elif product.stock_status == 'harvesting' %}
                        <span class="badge bg-info position-absolute bottom-0 end-0 m-2 px-2 py-1" style="font-size: 0.6rem;">Harvesting</span>
                        {% endif %}
                    </div>
                    
                    <div class="card-body text-center p-3">
                        <h6 class="card-title mb-2" style="height: 40px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                            <a href="{% url 'product_detail' product.slug %}" class="text-decoration-none text-dark">
                                {{ product.name }}
                            </a>
                        </h6>
                        
                        <div class="text-muted small mb-2">
                            <i class="fas fa-map-marker-alt me-1"></i>{{ product.farmer.county.name }}
                            <span class="ms-2">
                                <i class="fas fa-user me-1"></i>{{ product.farmer.farm_name }}
                            </span>
                        </div>
                       
                        <div class="price mb-2">
                            <span class="fw-bold text-success fs-6">KSh {{ product.selling_price }}</span>
                            {% if product.discount_price %}
                            <span class="text-muted text-decoration-line-through ms-1" style="font-size: 0.8rem;">KSh {{ product.price }}</span>
                            {% endif %}
                            <div class="text-muted small">per {{ product.get_unit_display }}</div>
                        </div>
                        
                        <div class="rating mb-2">
                            <div class="rating-stars">
                                {% if product.farmer.rating > 0 %}
                                    {% for i in "12345"|make_list %}
                                        {% if forloop.counter <= product.farmer.rating %}
                                        <i class="fas fa-star text-warning" style="font-size: 0.7rem;"></i>
                                        {% else %}
                                        <i class="far fa-star text-warning" style="font-size: 0.7rem;"></i>
                                        {% endif %}
                                    {% endfor %}
                                    <small class="text-muted ms-1" style="font-size: 0.7rem;">({{ product.farmer.total_reviews }})</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex border-top">
                        <small class="w-50 text-center border-end py-2">
                            <a class="text-body text-decoration-none" href="{% url 'product_detail' product.slug %}">
                                <i class="fa fa-eye text-primary me-1" style="font-size: 0.8rem;"></i>View Details
                            </a>
                        </small>
                        <small class="w-50 text-center py-2">
                            {% if product.is_in_stock %}
                            <a class="text-body text-decoration-none" href="#" onclick="addToCart({{ product.id }})">
                                <i class="fa fa-shopping-bag text-primary me-1" style="font-size: 0.8rem;"></i>Add Cart
                            </a>
                            {% else %}
                            <span class="text-muted">
                                <i class="fa fa-ban me-1" style="font-size: 0.8rem;"></i>Out of Stock
                            </span>
                            {% endif %}
                        </small>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-4">
            <a href="{% url 'product_list' %}?featured=true" class="btn btn-success rounded-pill px-4 py-2">
                View All Featured Products <i class="fas fa-arrow-right ms-1"></i>
            </a>
        </div>
    </div>
</section>
<!-- Featured Products End -->

<!-- About Start -->
<div class="container-xxl py-5">
    <div class="container">
        <div class="row g-5 align-items-center">
            <div class="col-lg-6 wow fadeIn" data-wow-delay="0.1s">
                <div class="about-img position-relative overflow-hidden p-5 pe-0">
                    <img class="img-fluid w-100" src="{% static 'img/about.jpg'%}" alt="About AgriConnect">
                </div>
            </div>
            <div class="col-lg-6 wow fadeIn" data-wow-delay="0.5s">
                <h1 class="display-5 mb-4">Connecting Farmers with Markets</h1>
                <p class="mb-4">AgriConnect bridges the gap between local farmers and consumers across Kenya. Our platform empowers farmers to reach wider markets while providing consumers with fresh, quality produce directly from the source.</p>
                <p><i class="fa fa-check text-primary me-3"></i>Direct farmer-to-consumer marketplace</p>
                <p><i class="fa fa-check text-primary me-3"></i>Quality assurance and farmer verification</p>
                <p><i class="fa fa-check text-primary me-3"></i>Nationwide delivery network</p>
                <p><i class="fa fa-check text-primary me-3"></i>Support for sustainable farming practices</p>
                <a class="btn btn-primary rounded-pill py-3 px-5 mt-3" href="">Learn More About Us</a>
            </div>
        </div>
    </div>
</div>
<!-- About End -->

<!-- Categories Section Start -->
<section id="categories" class="container-xxl py-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-6 mb-2">Shop by Category</h2>
            <p class="text-muted">Explore our wide range of agricultural products</p>
        </div>
        <div class="row g-4">
            {% for category in categories %}
            <div class="col-lg-3 col-md-6">
                <div class="card category-card h-100 border-0 shadow-sm hover-effect">
                    <div class="card-body text-center p-4">
                        {% if category.image %}
                        <img src="{{ category.image.url }}" alt="{{ category.name }}" class="img-fluid mb-3" style="height: 80px; width: 80px; object-fit: cover; border-radius: 50%;">
                        {% else %}
                        <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="height: 80px; width: 80px;">
                            {% if category.icon %}
                            <i class="{{ category.icon }} text-white fs-2"></i>
                            {% else %}
                            <i class="fas fa-leaf text-white fs-2"></i>
                            {% endif %}
                        </div>
                        {% endif %}
                        <h5 class="card-title mb-2">{{ category.name }}</h5>
                        {% if category.description %}
                        <p class="card-text text-muted small mb-3">{{ category.description|truncatechars:100 }}</p>
                        {% endif %}
                        <p class="card-text text-primary fw-bold">{{ category.product_count }} products available</p>
                        <a href="{% url 'category_products' category.slug %}" class="btn btn-outline-success rounded-pill px-4">
                            Explore <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
<!-- Categories Section End -->

<!-- Product Tabs Start -->
<section class="container-xxl py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-5 mb-3">Our Products</h2>
            <p class="lead text-muted">Fresh products categorized for your convenience</p>
        </div>
        
        <!-- Nav tabs -->
        <ul class="nav nav-pills justify-content-center mb-5" id="productTabs">
            <li class="nav-item me-2">
                <button class="btn btn-outline-success active" data-bs-toggle="pill" data-bs-target="#vegetables" type="button">
                    <i class="fas fa-carrot me-2"></i>Vegetables
                </button>
            </li>
            <li class="nav-item me-2">
                <button class="btn btn-outline-success" data-bs-toggle="pill" data-bs-target="#fruits" type="button">
                    <i class="fas fa-apple-alt me-2"></i>Fruits
                </button>
            </li>
            <li class="nav-item me-2">
                <button class="btn btn-outline-success" data-bs-toggle="pill" data-bs-target="#newArrivals" type="button">
                    <i class="fas fa-star me-2"></i>New Arrivals
                </button>
            </li>
            <li class="nav-item">
                <button class="btn btn-outline-success" data-bs-toggle="pill" data-bs-target="#organic" type="button">
                    <i class="fas fa-leaf me-2"></i>Organic
                </button>
            </li>
        </ul>
        
        <!-- Tab content -->
        <div class="tab-content" id="productTabContent">
            <!-- Vegetables Tab -->
            <div class="tab-pane fade show active" id="vegetables">
                <div class="row g-4">
                    {% for product in vegetables %}
                    <div class="col-xl-3 col-lg-4 col-md-6">
                        <div class="product-item card h-100 border-0 shadow-sm">
                            <div class="position-relative bg-light overflow-hidden" style="height: 200px;">
                                {% if product.main_image %}
                                <img src="{{ product.main_image.image.url }}" class="w-100 h-100" alt="{{ product.name }}" style="object-fit: cover;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center h-100">
                                    <i class="fas fa-seedling text-muted fs-1"></i>
                                </div>
                                {% endif %}
                                {% if product.discount_percentage %}
                                <div class="position-absolute top-0 start-0 m-3 py-1 px-2 bg-danger text-white rounded">
                                    -{{ product.discount_percentage }}%
                                </div>
                                {% endif %}
                            </div>
                            <div class="text-center p-3">
                                <a class="d-block h6 mb-2" href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                                <span class="text-primary me-1">KSh {{ product.selling_price }}</span>
                                {% if product.discount_price %}
                                <span class="text-body text-decoration-line-through">KSh {{ product.price }}</span>
                                {% endif %}
                                <div class="small text-muted mt-1">{{ product.farmer.farm_name }} - {{ product.farmer.county.name }}</div>
                            </div>
                            <div class="d-flex border-top">
                                <small class="w-50 text-center border-end py-2">
                                    <a class="text-body" href="{% url 'product_detail' product.slug %}">
                                        <i class="fa fa-eye text-primary me-2"></i>View detail
                                    </a>
                                </small>
                                <small class="w-50 text-center py-2">
                                    {% if product.is_in_stock %}
                                    <a class="text-body" href="#" onclick="addToCart({{ product.id }})">
                                        <i class="fa fa-shopping-bag text-primary me-2"></i>Add to cart
                                    </a>
                                    {% else %}
                                    <span class="text-muted">Out of stock</span>
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Fruits Tab -->
            <div class="tab-pane fade" id="fruits">
                <div class="row g-4">
                    {% for product in fruits %}
                    <div class="col-xl-3 col-lg-4 col-md-6">
                        <div class="product-item card h-100 border-0 shadow-sm">
                            <div class="position-relative bg-light overflow-hidden" style="height: 200px;">
                                {% if product.main_image %}
                                <img src="{{ product.main_image.image.url }}" class="w-100 h-100" alt="{{ product.name }}" style="object-fit: cover;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center h-100">
                                    <i class="fas fa-seedling text-muted fs-1"></i>
                                </div>
                                {% endif %}
                                {% if product.discount_percentage %}
                                <div class="position-absolute top-0 start-0 m-3 py-1 px-2 bg-danger text-white rounded">
                                    -{{ product.discount_percentage }}%
                                </div>
                                {% endif %}
                            </div>
                            <div class="text-center p-3">
                                <a class="d-block h6 mb-2" href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                                <span class="text-primary me-1">KSh {{ product.selling_price }}</span>
                                {% if product.discount_price %}
                                <span class="text-body text-decoration-line-through">KSh {{ product.price }}</span>
                                {% endif %}
                                <div class="small text-muted mt-1">{{ product.farmer.farm_name }} - {{ product.farmer.county.name }}</div>
                            </div>
                            <div class="d-flex border-top">
                                <small class="w-50 text-center border-end py-2">
                                    <a class="text-body" href="{% url 'product_detail' product.slug %}">
                                        <i class="fa fa-eye text-primary me-2"></i>View detail
                                    </a>
                                </small>
                                <small class="w-50 text-center py-2">
                                    {% if product.is_in_stock %}
                                    <a class="text-body" href="#" onclick="addToCart({{ product.id }})">
                                        <i class="fa fa-shopping-bag text-primary me-2"></i>Add to cart
                                    </a>
                                    {% else %}
                                    <span class="text-muted">Out of stock</span>
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- New Arrivals Tab -->
            <div class="tab-pane fade" id="newArrivals">
                <div class="row g-4">
                    {% for product in new_products %}
                    <div class="col-xl-3 col-lg-4 col-md-6">
                        <div class="product-item card h-100 border-0 shadow-sm">
                            <div class="position-relative bg-light overflow-hidden" style="height: 200px;">
                                {% if product.main_image %}
                                <img src="{{ product.main_image.image.url }}" class="w-100 h-100" alt="{{ product.name }}" style="object-fit: cover;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center h-100">
                                    <i class="fas fa-seedling text-muted fs-1"></i>
                                </div>
                                {% endif %}
                                <div class="position-absolute top-0 start-0 m-3 py-1 px-2 bg-info text-white rounded">
                                    New
                                </div>
                                {% if product.discount_percentage %}
                                <div class="position-absolute top-0 end-0 m-3 py-1 px-2 bg-danger text-white rounded">
                                    -{{ product.discount_percentage }}%
                                </div>
                                {% endif %}
                            </div>
                            <div class="text-center p-3">
                                <a class="d-block h6 mb-2" href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                                <span class="text-primary me-1">KSh {{ product.selling_price }}</span>
                                {% if product.discount_price %}
                                <span class="text-body text-decoration-line-through">KSh {{ product.price }}</span>
                                {% endif %}
                                <div class="small text-muted mt-1">{{ product.farmer.farm_name }} - {{ product.farmer.county.name }}</div>
                            </div>
                            <div class="d-flex border-top">
                                <small class="w-50 text-center border-end py-2">
                                    <a class="text-body" href="{% url 'product_detail' product.slug %}">
                                        <i class="fa fa-eye text-primary me-2"></i>View detail
                                    </a>
                                </small>
                                <small class="w-50 text-center py-2">
                                    {% if product.is_in_stock %}
                                    <a class="text-body" href="#" onclick="addToCart({{ product.id }})">
                                        <i class="fa fa-shopping-bag text-primary me-2"></i>Add to cart
                                    </a>
                                    {% else %}
                                    <span class="text-muted">Out of stock</span>
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Organic Tab -->
            <div class="tab-pane fade" id="organic">
                <div class="row g-4">
                    {% for product in organic_products %}
                    <div class="col-xl-3 col-lg-4 col-md-6">
                        <div class="product-item card h-100 border-0 shadow-sm">
                            <div class="position-relative bg-light overflow-hidden" style="height: 200px;">
                                {% if product.main_image %}
                                <img src="{{ product.main_image.image.url }}" class="w-100 h-100" alt="{{ product.name }}" style="object-fit: cover;">
                                {% else %}
                                <div class="bg-light d-flex align-items-center justify-content-center h-100">
                                    <i class="fas fa-seedling text-muted fs-1"></i>
                                </div>
                                {% endif %}
                                <div class="position-absolute top-0 start-0 m-3 py-1 px-2 bg-success text-white rounded">
                                    <i class="fas fa-leaf me-1"></i>Organic
                                </div>
                                {% if product.discount_percentage %}
                                <div class="position-absolute top-0 end-0 m-3 py-1 px-2 bg-danger text-white rounded">
                                    -{{ product.discount_percentage }}%
                                </div>
                                {% endif %}
                            </div>
                            <div class="text-center p-3">
                                <a class="d-block h6 mb-2" href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                                <span class="text-primary me-1">KSh {{ product.selling_price }}</span>
                                {% if product.discount_price %}
                                <span class="text-body text-decoration-line-through">KSh {{ product.price }}</span>
                                {% endif %}
                                <div class="small text-muted mt-1">{{ product.farmer.farm_name }} - {{ product.farmer.county.name }}</div>
                            </div>
                            <div class="d-flex border-top">
                                <small class="w-50 text-center border-end py-2">
                                    <a class="text-body" href="{% url 'product_detail' product.slug %}">
                                        <i class="fa fa-eye text-primary me-2"></i>View detail
                                    </a>
                                </small>
                                <small class="w-50 text-center py-2">
                                    {% if product.is_in_stock %}
                                    <a class="text-body" href="#" onclick="addToCart({{ product.id }})">
                                        <i class="fa fa-shopping-bag text-primary me-2"></i>Add to cart
                                    </a>
                                    {% else %}
                                    <span class="text-muted">Out of stock</span>
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <div class="text-center mt-5">
            <a href="{% url 'product_list' %}" class="btn btn-success btn-lg rounded-pill px-5">
                Browse All Products <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>
    </div>
</section>
<!-- Product Tabs End -->

<!-- Features Start -->
<div id="features" class="container-fluid bg-light bg-icon my-5 py-6">
    <div class="container">
        <div class="section-header text-center mx-auto mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 500px;">
            <h1 class="display-5 mb-3">Why Choose AgriConnect</h1>
            <p>Experience the difference with our commitment to quality, sustainability, and exceptional service</p>
        </div>
        <div class="row g-4">
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
                <div class="bg-white text-center h-100 p-4 p-xl-5 rounded shadow">
                    <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                        <i class="fas fa-seedling text-white fs-2"></i>
                    </div>
                    <h4 class="mb-3">Fast Delivery</h4>
                    <p class="mb-4">Reliable delivery network covering all major towns in Kenya. Get your fresh produce delivered within 24-48 hours.</p>
                    <a class="btn btn-outline-primary border-2 py-2 px-4 rounded-pill" href="">Learn More</a>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.7s">
                <div class="bg-white text-center h-100 p-4 p-xl-5 rounded shadow">
                    <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                        <i class="fab fa-whatsapp text-white fs-2"></i>
                    </div>
                    <h4 class="mb-3">Easy WhatsApp Ordering</h4>
                    <p class="mb-4">Simple ordering through WhatsApp for farmers and buyers. No internet? No problem! Order via SMS.</p>
                    <a class="btn btn-outline-primary border-2 py-2 px-4 rounded-pill" href="">Learn More</a>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.9s">
                <div class="bg-white text-center h-100 p-4 p-xl-5 rounded shadow">
                    <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                        <i class="fas fa-mobile-alt text-white fs-2"></i>
                    </div>
                    <h4 class="mb-3">M-Pesa Integration</h4>
                    <p class="mb-4">Secure payments through M-Pesa. Automatic payouts to farmers and transparent transaction tracking.</p>
                    <a class="btn btn-outline-primary border-2 py-2 px-4 rounded-pill" href="">Learn More</a>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="1.1s">
                <div class="bg-white text-center h-100 p-4 p-xl-5 rounded shadow">
                    <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                        <i class="fas fa-leaf text-white fs-2"></i>
                    </div>
                    <h4 class="mb-3">Sustainable Farming</h4>
                    <p class="mb-4">Supporting eco-friendly and organic farming practices. Promoting sustainable agriculture across Kenya.</p>
                    <a class="btn btn-outline-primary border-2 py-2 px-4 rounded-pill" href="">Learn More</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Features End -->

<!-- Stats Section Start -->
<section class="container-xxl py-5">
    <div class="container">
        <div class="row g-4 text-center">
            <div class="col-lg-3 col-md-6">
                <div class="counter-item">
                    <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 100px; height: 100px;">
                        <i class="fas fa-users text-success fs-1"></i>
                    </div>
                    <h2 class="display-4 fw-bold text-success mb-0" data-toggle="counter-up">1200+</h2>
                    <p class="fs-5">Registered Farmers</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="counter-item">
                    <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 100px; height: 100px;">
                        <i class="fas fa-shopping-cart text-success fs-1"></i>
                    </div>
                    <h2 class="display-4 fw-bold text-success mb-0" data-toggle="counter-up">5000+</h2>
                    <p class="fs-5">Products Available</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="counter-item">
                    <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 100px; height: 100px;">
                        <i class="fas fa-truck text-success fs-1"></i>
                    </div>
                    <h2 class="display-4 fw-bold text-success mb-0" data-toggle="counter-up">10000+</h2>
                    <p class="fs-5">Orders Delivered</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="counter-item">
                    <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 100px; height: 100px;">
                        <i class="fas fa-map-marker-alt text-success fs-1"></i>
                    </div>
                    <h2 class="display-4 fw-bold text-success mb-0" data-toggle="counter-up">47</h2>
                    <p class="fs-5">Counties Covered</p>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Stats Section End -->

<!-- Newsletter Start -->
<section class="container-xxl py-5 bg-success">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <div class="text-white">
                    <h3 class="mb-3">Stay Updated with Fresh Deals!</h3>
                    <p class="mb-4">Subscribe to get notifications about new products, special offers, and farming tips.</p>
                    <form class="row g-3 justify-content-center" method="post" action="{% url 'newsletter_subscribe' %}">
                        {% csrf_token %}
                        <div class="col-md-6">
                            <input type="email" name="email" class="form-control form-control-lg" placeholder="Enter your email" required>
                        </div>
                        <div class="col-auto">
                            <button type="submit" class="btn btn-light btn-lg px-4">
                                <i class="fas fa-bell me-2"></i>Subscribe
                            </button>
                        </div>
                    </form>
                    <small class="text-light mt-2 d-block">Join over 5,000 subscribers getting fresh updates!</small>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Newsletter End -->

<!-- How It Works Section Start -->
<section class="container-xxl py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-6 mb-2">How It Works</h2>
            <p class="text-muted">Simple steps to get fresh produce delivered</p>
        </div>
        <div class="row g-4">
            <div class="col-lg-3 col-md-6 text-center">
                <div class="step-item">
                    <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                        <span class="text-white fs-2 fw-bold">1</span>
                    </div>
                    <h5 class="mb-3">Browse Products</h5>
                    <p class="text-muted">Explore fresh produce from verified farmers across Kenya</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 text-center">
                <div class="step-item">
                    <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                        <span class="text-white fs-2 fw-bold">2</span>
                    </div>
                    <h5 class="mb-3">Place Your Order</h5>
                    <p class="text-muted">Order online or via WhatsApp for your convenience</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 text-center">
                <div class="step-item">
                    <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                        <span class="text-white fs-2 fw-bold">3</span>
                    </div>
                    <h5 class="mb-3">Make Payment</h5>
                    <p class="text-muted">Secure payment via M-Pesa or cash on delivery</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 text-center">
                <div class="step-item">
                    <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                        <span class="text-white fs-2 fw-bold">4</span>
                    </div>
                    <h5 class="mb-3">Get Delivery</h5>
                    <p class="text-muted">Fresh produce delivered to your doorstep within 24-48 hours</p>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- How It Works Section End -->

{% endblock %}

{% block extra_js %}
<script>
// WhatsApp ordering function
function orderViaWhatsApp(productName, price) {
    const message = `Hi! I'm interested in ordering: ${productName} (KSh ${price})`;
    const whatsappNumber = '+254700000000'; // Replace with your WhatsApp number
    const encodedMessage = encodeURIComponent(message);
    const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
    window.open(whatsappURL, '_blank');
}

// Add to cart function
async function addToCart(productId) {
    try {
        const response = await fetch(`/add-to-cart/${productId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({
                'product_id': productId,
                'quantity': 1
            })
        });

        const data = await response.json();
        
        if (data.success) {
            // Show success message
            showToast(data.message, 'success');
            
            // Update cart count
            updateCartCount(data.cart_total);
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        showToast('Error adding product to cart', 'error');
    }
}

// Get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Update cart count
function updateCartCount(count) {
    const cartBadge = document.getElementById('cart-count');
    if (cartBadge) {
        cartBadge.textContent = count;
        cartBadge.style.display = count > 0 ? 'inline' : 'none';
    }
}

// Show toast notification
function showToast(message, type = 'success') {
    const toastContainer = document.createElement('div');
    toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
    toastContainer.innerHTML = `
        <div class="toast show" role="alert">
            <div class="toast-header">
                <i class="fas fa-${type === 'success' ? 'check-circle text-success' : 'exclamation-triangle text-danger'} me-2"></i>
                <strong class="me-auto">${type === 'success' ? 'Success' : 'Error'}</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">${message}</div>
        </div>
    `;
    
    document.body.appendChild(toastContainer);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        toastContainer.remove();
    }, 3000);
}

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Counter animation
function animateCounters() {
    const counters = document.querySelectorAll('[data-toggle="counter-up"]');
    counters.forEach(counter => {
        const target = parseInt(counter.innerText.replace(/\D/g, ''));
        const duration = 2000;
        const step = target / (duration / 16);
        let current = 0;
        
        const timer = setInterval(() => {
            current += step;
            if (current >= target) {
                current = target;
                clearInterval(timer);
            }
            
            if (target >= 1000) {
                counter.innerText = Math.floor(current).toLocaleString() + '+';
            } else {
                counter.innerText = Math.floor(current);
            }
        }, 16);
    });
}

// Intersection Observer for counter animation
const counterObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            animateCounters();
            counterObserver.disconnect();
        }
    });
});

const statsSection = document.querySelector('.counter-item');
if (statsSection) {
    counterObserver.observe(statsSection);
}

// Auto-advance carousel
const heroCarousel = document.getElementById('header-carousel');
if (heroCarousel) {
    const carousel = new bootstrap.Carousel(heroCarousel, {
        interval: 6000,
        wrap: true,
        ride: 'carousel'
    });
}

// Lazy loading for images
if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                if (img.dataset.src) {
                    img.src = img.dataset.src;
                    img.classList.remove('lazy');
                    observer.unobserve(img);
                }
            }
        });
    });

    document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
    });
}

// Newsletter form submission
document.addEventListener('DOMContentLoaded', function() {
    const newsletterForm = document.querySelector('form[action="{% url 'newsletter_subscribe' %}"]');
    if (newsletterForm) {
        newsletterForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const submitButton = this.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Subscribing...';
            submitButton.disabled = true;
            
            try {
                const response = await fetch(this.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                    this.reset();
                } else {
                    showToast(data.message, 'error');
                }
            } catch (error) {
                showToast('Error subscribing to newsletter', 'error');
            } finally {
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        });
    }
});
</script>

<style>
.hover-effect {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-effect:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.product-item {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.product-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

.counter-item {
    opacity: 0;
    animation: fadeInUp 1s ease forwards;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.step-item {
    transition: transform 0.3s ease;
}

.step-item:hover {
    transform: translateY(-5px);
}

.lazy {
    opacity: 0;
    transition: opacity 0.3s;
}

.lazy.loaded {
    opacity: 1;
}

.toast {
    z-index: 1060;
}

@media (max-width: 768px) {
    .display-2 {
        font-size: 2rem;
    }
    
    .display-4 {
        font-size: 1.5rem;
    }
    
    .nav-pills .btn {
        margin-bottom: 10px;
        font-size: 0.9rem;
        padding: 8px 16px;
    }
}
</style>
{% endblock %}